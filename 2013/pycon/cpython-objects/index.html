<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Objetos en CPython</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/kaleidos.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section class="portada">
					<h1>Ojbetos en CPython</h1>
					<p>
						<small><a href="http://kaleidos.net">Kaleidos</a> / <a href="http://twitter.com/kaleidosnet">@kaleidosnet</a></small>
					</p>
					<p>
						<small>Jesús Espino García / <a href="http://twitter.com/jespinog">@jespinog</a></small>
					</p>
				</section>

				<section>
                    <section class="slide">
                        <h2>introducción</h2>
                    </section>
                    <section class="slide">
                        <h2>objetivos</h2>
                        <ul>
                            <li>explicar la estructura de un objeto en cpython.</li>
                            <li>explicar el proceso de creacion de un nuevo objeto</li>
                            <li>explicar los objetos escritos en c de python.</li>
                        </ul>
                    </section>
                </section>

				<section>
                    <section class="slide">
                        <h2>¿Que es un tipo en python?</h2>
                        <ul>
                            <li>Un tipo es una clase</li>
                            <li>Es una estructura compuesta de datos y slots</li>
                            <li>Los slots son punteros a funciones que definen comportamientos</li>
                            <li>Los tipos son objetos de python</li>
                            <li>Los tipos son de tipo tipo (??????)</li>
                        </ul>
                    </section>
                    <section class="slide">
                        <h2>¿Que es un tipo en python?</h2>
                        <pre><code data-trim contenteditable>
>>> class Prueba:
...   pass
... 
>>> type(Prueba)
&lt;class 'type'>
>>> isinstance(Prueba, object)
True
>>> isinstance(type, object)
True
>>> type(type)
&lt;class 'type'>
                        </code></pre>
                    </section>
                    <section class="slide">
                        <h2>¿Que es una instancia?</h2>
                        <ul>
                            <li>Es exactamente lo mismo que un objeto.</li>
                            <li>Es una zona reservada de la memoria con datos.</li>
                            <li>Tiene un tipo (y solo 1) que determina que puede hacer el objeto.</li>
                            <li>El tipo de un objeto no cambia a lo largo de su vida (existen excepciones).</li>
                        </ul>
                    </section>
                    <section class="slide">
                        <h2>¿Que es una instancia?</h2>
                        <pre><code data-trim contenteditable>
>>> prueba = Prueba()
>>> type(prueba)
&lt;class '__main__.Prueba'>
>>> prueba
&lt;__main__.Prueba object at 0x7f3555af9bd0>
>>> Prueba
&lt;class '__main__.Prueba'>
>>> id(prueba)
139867047566288
>>> hex(id(prueba))
'0x7f3555af9bd0'
                        </code></pre>
                    </section>
                </section>

				<section>
					<section class="slide">
						<h2>Estructura básica de un objeto</h2>
                        <ul>
                            <li>Un contador de referencias</li>
                            <li>Un puntero al tipo de datos</li>
                            <li>Otros datos especificos para este tipo</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>Estructura variable básica de un objeto</h2>
                        <ul>
                            <li>Un contador de referencias</li>
                            <li>Un puntero al tipo de datos</li>
                            <li>Un entero que define el tamaño del objeto</li>
                            <li>Otros datos especificos para este tipo</li>
                        </ul>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto None</h2>
                        <ul>
                            <li>Es el tipo más simple</li>
                            <li>Su instancia es singleton</li>
                            <li>No añade ningun dato extra a la estructura básica de objeto</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>Principales slot definidos</h2>
                        <ul>
                            <li>tp_new: Devuelve la instancia de none</li>
                            <li>tp_dealloc: Falla, nunca debe ser llamado</li>
                            <li>tp_as_number-&gt;nb_bool: Devuelve un 0</li>
                        </ul>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto int</h2>
                        <ul>
                            <li>Añade ob_digit al objeto variable basico</li>
                            <li>El ob_digit es un array de enteros</li>
                            <li>El valor del entero es sum(map(lambda x: 1024*1024*1024, ob_size))
                        </ul>
					</section>
					<section class="slide">
						<h2>El objeto int</h2>
                        <pre><code data-trim contenteditable>
>>> longsize = ctypes.sizeof(ctypes.c_long)
>>> intsize = ctypes.sizeof(ctypes.c_int)
>>> x = 100
>>> ctypes.c_long.from_address(id(x) + longsize * 2)
c_long(1)
>>> ctypes.c_uint.from_address(id(x) + longsize * 3)
c_uint(100)
>>> x = 1024 * 1024 * 1024
>>> ctypes.c_long.from_address(id(x) + longsize * 2)
c_long(2)
>>> ctypes.c_uint.from_address(id(x) + longsize * 3)
c_uint(0)
>>> ctypes.c_uint.from_address(id(x) + longsize * 3 + intsize)
c_uint(1)
                        </code></pre>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto bool</h2>
                        <ul>
                            <li>Realmente son 2 instancias int con un tipo especifico y valores 0 y 1</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>El objeto bool</h2>
                        <pre><code data-trim contenteditable>
>>> longsize = ctypes.sizeof(ctypes.c_long)
>>> intsize = ctypes.sizeof(ctypes.c_int)
>>> ctypes.c_long.from_address(id(True) + longsize * 2)
c_long(1)
>>> ctypes.c_uint.from_address(id(True) + longsize * 3)
c_uint(1)
>>> ctypes.c_long.from_address(id(False) + longsize * 2)
c_long(1)
>>> ctypes.c_uint.from_address(id(False) + longsize * 3)
c_uint(0)
                        </code></pre>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto float</h2>
                        <ul>
                            <li>Añade ob_fval al objeto básico</li>
                            <li>El ob_fval es un double</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>El objeto float</h2>
                        <pre><code data-trim contenteditable>
>>> longsize = ctypes.sizeof(ctypes.c_long)
>>> x = 1.5
>>> ctypes.c_double.from_address(id(x) + longsize * 2)
c_double(1.5)
                        </code></pre>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto complex</h2>
                        <ul>
                            <li>Añade cval al objeto básico</li>
                            <li>cval se compone de dos valores double real e imag</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>El objeto complex</h2>
                        <pre><code data-trim contenteditable>
>>> longsize = ctypes.sizeof(ctypes.c_long)
>>> doublesize = ctypes.sizeof(ctypes.c_double)
>>> x = 1 + 3j
>>> ctypes.c_double.from_address(id(x) + longsize * 2)
c_double(1.0)
>>> ctypes.c_double.from_address(id(x) + longsize * 2 + doublesize)
c_double(3.0)
                        </code></pre>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto bytes</h2>
                        <ul>
                            <li>Añade ob_shash y ob_sval al objeto variable básico</li>
                            <li>ob_shash almacena el hash de la cadena o -1</li>
                            <li>ob_sval es una cadena terminada en \0 (tipo C)</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>El objeto bytes</h2>
                        <pre><code data-trim contenteditable>
>>> longsize = ctypes.sizeof(ctypes.c_long)
>>> charsize = ctypes.sizeof(ctypes.c_char)
>>> x = b"yep"
>>> ctypes.c_long.from_address(id(x) + longsize * 2)
c_long(3)
>>> hash(x)
954696267706832433
>>> ctypes.c_long.from_address(id(x) + longsize * 3)
c_long(954696267706832433)
>>> ctypes.c_char.from_address(id(x) + longsize * 4)
c_char(b'y')
>>> ctypes.c_char.from_address(id(x) + longsize * 4 + charsize)
c_char(b'e')
>>> ctypes.c_char.from_address(id(x) + longsize * 4 + charsize * 2)
c_char(b'p')
>>> ctypes.c_char.from_address(id(x) + longsize * 4 + charsize * 3)
c_char(b'\x00')
                        </code></pre>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto bytearray</h2>
                        <ul>
                            <li>Añade ob_exports, ob_alloc y ob_bytes al objeto variable básico</li>
                            <li>ob_exports contaibliza los buffers apuntando a este objeto (memoryview en python3)</li>
                            <li>ob_alloc contabiliza el numero de bytes almacenados</li>
                            <li>ob_bytes almacena un puntero a la posición de los bytes almacenados</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>El objeto bytearray</h2>
                        <pre><code data-trim contenteditable>
>>> longsize = ctypes.sizeof(ctypes.c_long)
>>> charsize = ctypes.sizeof(ctypes.c_char)
>>> x = bytearray(b"yep")
>>> ctypes.c_long.from_address(id(x) + longsize * 2)
c_long(3)
>>> ctypes.c_long.from_address(id(x) + longsize * 3)
c_long(0)
>>> ctypes.c_long.from_address(id(x) + longsize * 4)
c_char(4)
>>> addr = ctypes.c_void_p.from_address(id(x) + longsize * 5).value
>>> ctypes.c_char.from_address(addr)
c_char(b'y')
>>> ctypes.c_char.from_address(addr + charsize)
c_char(b'e')
                        </code></pre>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto unicode</h2>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto tuple</h2>
                        <ul>
                            <li>Añade ob_item al objeto variable básico</li>
                            <li>ob_item es un array de punteros a PyObject</li>
                        </ul>
					</section>
					<section class="slide">
						<h2>El objeto tuple</h2>
                        <pre><code data-trim contenteditable>
>>> longsize = ctypes.sizeof(ctypes.c_long)
>>> x = (True, False)
>>> ctypes.c_long.from_address(id(x) + longsize * 2)
c_long(2)
>>> ctypes.c_void_p.from_address(id(x) + longsize * 3)
c_void_p(140048684311616)
>>> ctypes.c_long.from_address(id(x) + longsize * 4)
c_void_p(140048684311648)
>>> id(True)
140048684311616
>>> id(False)
140048684311648
                        </code></pre>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto list</h2>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El objeto dict</h2>
					</section>
				</section>

				<section>
					<section class="slide">
						<h2>El proceso de creación de un objeto.</h2>
					</section>
				</section>

				<section class="slide">
					<h2>Referencias</h2>
					<ul>
                        <li>Proyecto python: http://www.python.org.</li>
                        <li>Documentación de python: http://docs.python.org.</li>
                        <li>Python-ES: python-es@python.org</li>
					</ul>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
